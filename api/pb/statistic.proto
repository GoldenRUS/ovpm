syntax = "proto3";

package pb;
option go_package = "github.com/GoldenRUS/ovpm/api/pb";

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";


message EmptyRequest {}

message StatisticWithFilterRequest {
  string dateFrom = 1;
  string dateTo = 2;
  string username = 3;
}

service StatisticService {
  rpc List (EmptyRequest) returns (StatisticResponse) {
    option (google.api.http) = {
      get: "/api/v1/statistic/list"
      //body: "*"
    };

  }
  rpc WFilterList (StatisticWithFilterRequest) returns (StatisticResponse) {
    option (google.api.http) = {
      post: "/api/v1/statistic/list"
      body: "*"
    };
  }
  rpc GetSystemStatus (EmptyRequest) returns (SystemStatus) {
    option (google.api.http) = {
      get: "/api/v1/statistic/system/status"
    };
  }
 rpc GetInterfaces (EmptyRequest) returns (NetworkInterfacesResponse) {
    option (google.api.http) = {
      get: "/api/v1/statistic/network/interfaces"
    };
  }
  rpc GetInterfaceStats (InterfaceStatsRequest) returns (InterfaceStatsResponse) {
    option (google.api.http) = {
      get: "/api/v1/statistic/network/interface/{interface_name}/stats"
    };
  }

}


message StatisticResponse {
  message Statistic {
    string username = 1;
    int64 connection_count = 2;
    int64 total_bytes_received = 3;
    int64 total_bytes_sent = 4;
    int64 total_bytes = 5;
    int64 avg_connection_duration = 6;
  }

  repeated Statistic statistic = 1;
}



message SystemStatus {
  double cpu_usage = 1;
  uint64 memory_total = 2;
  uint64 memory_used = 3;
  uint64 swap_total = 4;
  uint64 swap_used = 5;
  repeated double load_average = 6;
  repeated DiskUsage disk_usage = 7;
  google.protobuf.Timestamp timestamp = 8;
}

message DiskUsage {
  string mount = 1;
  uint64 total = 2;
  uint64 used = 3;
  double used_percentage = 4;
}


message NetworkInterface {
  string name = 1;
  string ip = 2;
  string mac = 3;
  bool is_up = 4;
}

message NetworkInterfacesResponse {
  repeated NetworkInterface interfaces = 1;
}

message InterfaceStats {
  string interface_name = 1;
  uint64 tx_bytes = 2;
  uint64 rx_bytes = 3;
  uint64 tx_bytes_per_sec = 4;
  uint64 rx_bytes_per_sec = 5;
  uint64 tx_packets = 6;
  uint64 rx_packets = 7;
  google.protobuf.Timestamp timestamp = 8;
}

message InterfaceStatsResponse {
  InterfaceStats stats = 1;
}

message InterfaceStatsRequest {
  string interface_name = 1;
}